@{
    ViewData["Title"] = "Create Profile";
}

@model Chefster.Models.FamilyModel2

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <form class="row g-3" action="/api/family" method="post">
                <div class="fs-4">
                    Tell us a bit about yourself...
                </div>
                <hr>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="PhoneNumber">Phone Number</label>
                            <input type="tel" pattern="[0-9]{3}-[0-9]{2}-[0-9]{3}" class="form-control" id="PhoneNumber" name="PhoneNumber" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="FamilySize">Number of Family Members</label>
                            <input type="number" class="form-control" min="1" max="10" value="1" id="FamilySize" name="FamilySize" required>
                        </div>
                    </div>
                </div>
                <div id="familyMembersContainer"></div>
                <div class="fs-4">
                    When would you like to receive weekly recipes?
                </div>
                <hr>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="GenerationDay">Day of Week</label>
                            <select class="form-control" asp-for="GenerationDay" asp-items="Html.GetEnumSelectList<DayOfWeek>()" required></select>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="GenerationTime">Time</label>
                            <input class="form-control" type="time" id="GenerationTime" name="GenerationTime" required />
                        </div>
                    </div>
                </div>
                <div class="form-group mt-3">
                    <button type="submit" class="btn btn-primary ms-auto">Create Profile</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const familySizeInput = document.getElementById('FamilySize');
            const familyMembersContainer = document.getElementById('familyMembersContainer');

            familySizeInput.addEventListener('input', function () {
                const familySize = parseInt(familySizeInput.value);
                familyMembersContainer.innerHTML = '';

                for (let i = 0; i < familySize; i++) {
                    // Load the partial view for each family member
                    fetch(`/MemberForm?index=${i+1}`)
                        .then(response => response.text())
                        .then(html => {
                            // Append the HTML of the partial view to the container
                            familyMembersContainer.innerHTML += html;
                        });
                }
            });

            // Trigger the input event to initialize the form fields on page load
            familySizeInput.dispatchEvent(new Event('input'));
        });
    </script>
}
